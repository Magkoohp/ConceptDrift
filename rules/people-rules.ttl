@prefix rule: <tag:stardog:api:rule:> .
@prefix qb: <http://purl.org/linked-data/cube#> .
@prefix sdmx-dimension: <http://purl.org/linked-data/sdmx/2009/dimension#> .
@prefix eg: <http://example.org/ns#> .

# num1 : 0 <= age

eg:num1 a rule:SPARQLRule ;
   rule:content """
       PREFIX sdmx-dimension: <http://purl.org/linked-data/sdmx/2009/dimension#>
       PREFIX qb: <http://purl.org/linked-data/cube#> 
     IF {
       ?obs a qb:Observation .
       ?obs sdmx-dimension:age ?age .
       FILTER (?age < 0)
     }
     THEN {
       ?obs eg:violates eg:num1
     }
   """.

# num2 : 0 < height

eg:num2 a rule:SPARQLRule ;
   rule:content """
       PREFIX eg: <http://example.org/ns#>
       PREFIX qb: <http://purl.org/linked-data/cube#> 
     IF {
       ?obs a qb:Observation .
       ?obs eg:height ?height .
       FILTER (?height <= 0)
     }
     THEN {
       ?obs eg:violates eg:num2
     }
   """.

# num3 : age <= 150

eg:num3 a rule:SPARQLRule ;
   rule:content """
       PREFIX sdmx-dimension: <http://purl.org/linked-data/sdmx/2009/dimension#>
       PREFIX qb: <http://purl.org/linked-data/cube#> 
     IF {
       ?obs a qb:Observation .
       ?obs sdmx-dimension:age ?age .
       FILTER (?age > 150)
     }
     THEN {
       ?obs eg:violates eg:num3
     }
   """.

# num4 : yearsmarried < age

eg:num4 a rule:SPARQLRule ;
   rule:content """
       PREFIX eg: <http://example.org/ns#>
       PREFIX qb: <http://purl.org/linked-data/cube#> 
     IF {
       ?obs a qb:Observation .
       ?obs sdmx-dimension:age ?age .
       ?obs eg:yearsMarried ?yearsMarried .
       FILTER (?yearsMarried >= ?age)
     }
     THEN {
       ?obs eg:violates eg:num4
     }
   """.

# cat5 : if( agegroup == 'child' ) status != 'married'

eg:cat5 a rule:SPARQLRule ;
   rule:content """
       PREFIX eg: <http://example.org/ns#>
       PREFIX qb: <http://purl.org/linked-data/cube#>
       PREFIX sdmx-dimension: <http://purl.org/linked-data/sdmx/2009/dimension#>
     IF {
       ?obs a qb:Observation .
       ?obs sdmx-dimension:civilStatus ?civilStatus .
       ?obs eg:agegroup ?ageGroup .
       FILTER (?ageGroup = "child")
       FILTER (?status = "married")
     }
     THEN {
       ?obs eg:violates eg:cat5
     }
   """.

# mix6 : if( age < yearsmarried + 17 ) !( status %in% c('married', 'widowed') )

eg:mix6 a rule:SPARQLRule ;
   rule:content """
       PREFIX eg: <http://example.org/ns#>	
       PREFIX qb: <http://purl.org/linked-data/cube#> 
       PREFIX sdmx-dimension: <http://purl.org/linked-data/sdmx/2009/dimension#>
     IF {
       ?obs a qb:Observation .
       ?obs sdmx-dimension:civilStatus ?civilStatus .
       ?obs eg:yearsMarried ?yearsMarried .
       ?obs sdmx-dimension:age ?age .
       FILTER (?age < ?yearsMarried + 17)
       FILTER (?status IN ("married", "widowed"))
     }
     THEN {
       ?obs eg:violates eg:mix6
     }
   """.

# # mix7 : if( age < 18 ) !( agegroup %in% c('adult', 'elderly') )

eg:mix7 a rule:SPARQLRule ;
   rule:content """
       PREFIX eg: <http://example.org/ns#>	
       PREFIX qb: <http://purl.org/linked-data/cube#> 
     IF {
       ?obs a qb:Observation .
       ?obs eg:agegroup ?ageGroup .
       ?obs sdmx-dimension:age ?age .
       FILTER (?age < 18)
       FILTER (?ageGroup IN ("adult", "elderly"))
     }
     THEN {
       ?obs eg:violates eg:mix7
     }
   """.

# # mix8 : if( 18 <= age & age < 65 ) !( agegroup %in% c('child', 'elderly') )

eg:mix8 a rule:SPARQLRule ;
   rule:content """
       PREFIX eg: <http://example.org/ns#>	
       PREFIX qb: <http://purl.org/linked-data/cube#> 
     IF {
       ?obs a qb:Observation .
       ?obs eg:agegroup ?ageGroup .
       ?obs sdmx-dimension:age ?age .
       FILTER (18 <= ?age && ?age < 65)
       FILTER (?ageGroup IN ("child", "elderly"))
     }
     THEN {
       ?obs eg:violates eg:mix8
     }
   """.

# # mix9 : if( 65 <= age ) !( agegroup %in% c('adult', 'child') ) 

eg:mix9 a rule:SPARQLRule ;
   rule:content """
       PREFIX eg: <http://example.org/ns#>	
       PREFIX qb: <http://purl.org/linked-data/cube#> 
     IF {
       ?obs a qb:Observation .
       ?obs eg:agegroup ?ageGroup .
       ?obs sdmx-dimension:age ?age .
       FILTER (65 <= ?age)
       FILTER (?ageGroup IN ("adult", "child"))
     }
     THEN {
       ?obs eg:violates eg:mix9
     }
   """.

# If something is an observation is also a foo
# eg:foo-rule a rule:SPARQLRule ;
#    rule:content """
#        PREFIX qb: <http://purl.org/linked-data/cube#>
#        PREFIX sdmx-dimension: <http://purl.org/linked-data/sdmx/2009/dimension#>
#      IF {
#        ?obs a qb:Observation
#      }
#      THEN {
#        ?obs a eg:foo 
#      }
#    """.
